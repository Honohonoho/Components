<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>曝光加载</title>
  <style>
    ul,li{
      list-style:none;
    }
    .container{
      width: 600px;
      margin: 0 auto;
    }
    .container li{
      float: left;
      margin: 10px 10px;
    }
    .container li img{
      width: 260px;
      height: 200px;
    }
    .clearfix:after{
    	content: "";
    	display: block;
    	clear: both;
    }
  </style>
</head>
<body>
<ul class="container clearfix">
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a></li>
  <li><a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a></li>

</ul>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
/*
	check();
	$(window).on('scroll',check);
	var $node = $('.container img');

	function isVisible($node){
		var windowHeight = $(window).height(), //窗口高度
			scrollTop = $(window).scrollTop(), //滚动条滚动距离
			offsetTop = $node.offset().top, //元素距页面顶端高度
			nodeHeight = $node.outerHeight(true); //包括外边距
		if(windowHeight + scrollTop > offsetTop && scrollTop < offsetTop + nodeHeight){ //已进入页面，且未离开页面
			return true;
		}else{
			return false;
		}
	}

	function show($node){
		$node.each(function(){
			var imgUrl = $(this).attr('data-src');
			$(this).attr('src',imgUrl);
			$(this).addClass('load'); //已经加载的元素添加class:load
			console.log(true) //测试用
		});
	}
	function check(){
		$('.container img').not('.load').each(function(){ //遍历未添加class为load的元素
			if(isVisible($(this))){
				show($(this))
			}
		});
	}
*/
  function Exposure($target,callback){
    this.$target = $target;
    this.callback = callback;
    this.bind();
    this.check();
  }

  Exposure.prototype.bind = function(){
    var _this = this;
    $(window).on('scroll',function(){
      _this.check();
    })
  }

  Exposure.prototype.check = function(){
    if(this.isShow(this.$target)){
      this.callback(this.$target);
    }
  }

  Exposure.prototype.isShow = function(){
    var windowHeight = $(window).height(), //窗口高度
        scrollTop = $(window).scrollTop(), //滚动条滚动距离
        offsetTop = this.$target.offset().top, //元素距页面顶端高度
        nodeHeight = this.$target.outerHeight(true); //包括外边距
    if(windowHeight + scrollTop > offsetTop && scrollTop < offsetTop + nodeHeight){ //已进入页面，且未离开页面
      return true;
    }else{
      return false;
    }
  }

  function showImg($img){
    var imgUrl = $img.attr('data-src');
    $img.attr('src',imgUrl);
  }

  var Lazy = (function(){
    return {
      init: function($targets,callback){
        $targets.each(function(idx,target){
          new Exposure($(target),callback);
        })
      }
    }
  })();//有缺陷，外部可以随意修改内部成员，这样就会产生意外的安全问题，可以通过立即执行函数，来达到隐藏细节的目的

  Lazy.init($('.container img'),function($node){
    showImg($node);
  });

  

</script>
</body>
</html>
